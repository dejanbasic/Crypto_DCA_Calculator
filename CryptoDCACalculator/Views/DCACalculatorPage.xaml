<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sys="clr-namespace:System;assembly=System.Runtime"
             xmlns:chart="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts"
             x:Class="CryptoDCACalculator.Views.DCACalculatorPage"
             Title="DCA Calculator"
             BackgroundColor="#1a1a1a">

    <ContentPage.Resources>
        <Style x:Key="ChartAxisLabelStyle" TargetType="Label">
            <Setter Property="TextColor" Value="#B0B0B0" />
            <Setter Property="FontSize" Value="10" />
        </Style>
    </ContentPage.Resources>
             
    <ScrollView>
        <Grid RowDefinitions="Auto,Auto,*">

            <!-- Header -->
            <Frame Grid.Row="0" 
                BackgroundColor="#2d2d2d" 
                BorderColor="#404040" 
                CornerRadius="10" 
                Margin="15,15,15,10" 
                Padding="20">
                
                <VerticalStackLayout Spacing="10">
                    <Grid ColumnDefinitions="*,Auto">
                        
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="ðŸ’° Crypto DCA Calculator" 
                                FontSize="20" 
                                FontAttributes="Bold" 
                                TextColor="White" />
                            <Label x:Name="UserLabel" 
                                Text="Welcome back!" 
                                FontSize="14" 
                                TextColor="#B0B0B0" />
                            <!-- Real-time indicator -->
                            <StackLayout Orientation="Horizontal" Spacing="5" Margin="0,3,0,0">
                                <Ellipse x:Name="RealTimeIndicator" 
                                         Fill="#4CAF50" 
                                         WidthRequest="8" 
                                         HeightRequest="8" />
                                <Label x:Name="RealTimeLabel" 
                                       Text="Live prices connected" 
                                       FontSize="10" 
                                       TextColor="#4CAF50" />
                            </StackLayout>
                        </VerticalStackLayout>
                        
                        <Button Grid.Column="1" 
                                x:Name="LogoutButton"
                                Text="Logout" 
                                BackgroundColor="#FF6B6B" 
                                TextColor="White" 
                                CornerRadius="5"
                                HeightRequest="40"
                                VerticalOptions="Start"
                                Clicked="OnLogoutClicked" />
                    </Grid>

                    <!-- Cryptocurrency Ticker -->
                    <ScrollView Orientation="Horizontal" HeightRequest="70">
                        <HorizontalStackLayout x:Name="CryptoPriceTicker" Spacing="5" Padding="5">
                            <!-- Crypto price items will be added dynamically -->
                        </HorizontalStackLayout>
                    </ScrollView>
                </VerticalStackLayout>
            </Frame>

            <Frame Grid.Row="1" 
                BackgroundColor="#2d2d2d" 
                BorderColor="#404040" 
                CornerRadius="10" 
                Margin="15,0,15,10" 
                Padding="20">
                
                <VerticalStackLayout Spacing="15">

                    <!-- Multiple Investments Configuration -->
                    <VerticalStackLayout Spacing="10">
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0" 
                                Text="Investment Portfolio" 
                                FontSize="16" 
                                FontAttributes="Bold" 
                                TextColor="White"
                                VerticalOptions="Center" />
                            <Button Grid.Column="1"
                                    x:Name="AddInvestmentButton"
                                    Text="+ Add Crypto"
                                    BackgroundColor="#4CAF50"
                                    TextColor="White"
                                    CornerRadius="5"
                                    FontSize="12"
                                    FontAttributes="Bold"
                                    Clicked="OnAddInvestmentClicked" />
                        </Grid>
                        
                        <!-- Investments Container -->
                        <VerticalStackLayout x:Name="InvestmentsContainer" Spacing="10">
                            <!-- Investment items will be added dynamically -->
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="*,Auto">
                        
                        <Button Grid.Column="0" 
                                x:Name="CalculateButton" 
                                Text="Calculate DCA Performance" 
                                BackgroundColor="#4CAF50" 
                                TextColor="White" 
                                CornerRadius="8" 
                                HeightRequest="45"
                                FontAttributes="Bold"
                                Clicked="OnCalculateClicked" />
                        
                        <Button Grid.Column="1" 
                                x:Name="SaveInvestmentButton" 
                                Text="ðŸ’¾" 
                                BackgroundColor="#FF9800" 
                                TextColor="White" 
                                CornerRadius="8" 
                                WidthRequest="45"
                                HeightRequest="45"
                                Margin="10,0,0,0"
                                Clicked="OnSaveInvestmentClicked" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Results -->
            <VerticalStackLayout x:Name="ResultsContainer" Spacing="15" Grid.Row="2" Margin="15,0,15,15">
                
                <!-- Loading Indicator -->
                <ActivityIndicator x:Name="LoadingIndicator" 
                                    IsVisible="False" 
                                    IsRunning="False" 
                                    Color="#4CAF50" 
                                    HeightRequest="50" />
                
                <!-- Portfolio Summary -->
                <Frame x:Name="SummaryFrame" 
                        BackgroundColor="#2d2d2d" 
                        BorderColor="#404040" 
                        CornerRadius="10" 
                        Padding="20"
                        IsVisible="False">
                    
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Portfolio Summary" 
                                FontSize="18" 
                                FontAttributes="Bold" 
                                TextColor="White" />

                        <Grid ColumnDefinitions="*,*,*">
                            
                            <VerticalStackLayout Grid.Column="0">
                                <Label Text="Total Invested" TextColor="#B0B0B0" FontSize="12" />
                                <Label x:Name="TotalInvestedLabel" 
                                        Text="â‚¬0.00" 
                                        FontSize="16" 
                                        FontAttributes="Bold" 
                                        TextColor="White" />
                            </VerticalStackLayout>
                            
                            <VerticalStackLayout Grid.Column="1">
                                <Label Text="Current Value" TextColor="#B0B0B0" FontSize="12" />
                                <Label x:Name="CurrentValueLabel" 
                                        Text="â‚¬0.00" 
                                        FontSize="16" 
                                        FontAttributes="Bold" 
                                        TextColor="#4CAF50" />
                            </VerticalStackLayout>
                            
                            <VerticalStackLayout Grid.Column="2">
                                <Label Text="ROI" TextColor="#B0B0B0" FontSize="12" />
                                <Label x:Name="ROILabel" 
                                        Text="0.00%" 
                                        FontSize="16" 
                                        FontAttributes="Bold" 
                                        TextColor="#FFD700" />
                            </VerticalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Holdings Summary -->
                <Frame x:Name="HoldingsFrame" 
                        BackgroundColor="#2d2d2d" 
                        BorderColor="#404040" 
                        CornerRadius="10" 
                        Padding="20"
                        IsVisible="False">
                    
                    <VerticalStackLayout>
                        <Label Text="Current Holdings" 
                                FontSize="18" 
                                FontAttributes="Bold" 
                                TextColor="White" 
                                Margin="0,0,0,15" />
                        
                        <VerticalStackLayout x:Name="HoldingsContainer" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Monthly Results Table -->
                <Frame x:Name="ResultsFrame" 
                        BackgroundColor="#2d2d2d" 
                        BorderColor="#404040" 
                        CornerRadius="10" 
                        Padding="20"
                        IsVisible="False">
                    
                    <VerticalStackLayout>
                        <Label Text="Monthly Investment Results" 
                                FontSize="18" 
                                FontAttributes="Bold" 
                                TextColor="White" 
                                Margin="0,0,0,15" />
                        
                        <!-- Table Header -->
                        <Grid BackgroundColor="#404040" Padding="10,8" ColumnDefinitions="*,*,*,*,*">
                            
                            <Label Grid.Column="0" Text="Date" FontAttributes="Bold" TextColor="White" FontSize="12" VerticalOptions="Center" />
                            <Label Grid.Column="1" Text="Invested amount" FontAttributes="Bold" TextColor="White" FontSize="12" />
                            <Label x:Name="CryptoAmountLabel" Grid.Column="2" FontAttributes="Bold" TextColor="White" FontSize="12" />
                            <Label Grid.Column="3" Text="Value today" FontAttributes="Bold" TextColor="White" FontSize="12" />
                            <Label Grid.Column="4" Text="ROI" FontAttributes="Bold" TextColor="White" FontSize="12" VerticalOptions="Center" />
                        </Grid>
                        
                        <!-- Table Content -->
                        <VerticalStackLayout x:Name="ResultsTableContainer" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Competing Performance Chart -->
                <Frame x:Name="CompetingChartFrame" 
                        BackgroundColor="#2d2d2d" 
                        BorderColor="#404040" 
                        CornerRadius="10" 
                        Padding="15"
                        IsVisible="False">
                    
                    <VerticalStackLayout>
                        <Label Text="Performance vs Top 10 Coins" 
                                FontSize="18" 
                                FontAttributes="Bold" 
                                TextColor="White" 
                                Margin="0,0,0,5" />
                        
                        <Label Text="Compare how your DCA strategy performs against investing the same amounts in other Top 10 cryptocurrencies over the same time period. Your portfolio is shown as a solid green area, while competing coins are shown as semi-transparent areas." 
                                FontSize="12" 
                                TextColor="#B0B0B0" 
                                Margin="0,0,0,10" />
                        
                        <!-- Performance Summary -->
                        <VerticalStackLayout x:Name="PerformanceSummary" Spacing="5" Margin="0,0,0,15" />
                        
                        <chart:SfCartesianChart x:Name="CompetingChart" 
                                                HeightRequest="300"
                                                BackgroundColor="Transparent">
                            
                            <chart:SfCartesianChart.Legend>
                                <chart:ChartLegend x:Name="ChartLegend" 
                                                   IsVisible="True" 
                                                   Placement="Bottom" 
                                                   LabelStyle="{StaticResource ChartAxisLabelStyle}" />
                            </chart:SfCartesianChart.Legend>
                            
                            <chart:SfCartesianChart.XAxes>
                                <chart:DateTimeAxis x:Name="ChartXAxis" 
                                                    ShowMajorGridLines="True"
                                                    LabelStyle="{StaticResource ChartAxisLabelStyle}" />
                            </chart:SfCartesianChart.XAxes>
                            
                            <chart:SfCartesianChart.YAxes>
                                <chart:NumericalAxis x:Name="ChartYAxis" 
                                                     ShowMajorGridLines="True"
                                                     LabelStyle="{StaticResource ChartAxisLabelStyle}" />
                            </chart:SfCartesianChart.YAxes>
                            
                        </chart:SfCartesianChart>
                    </VerticalStackLayout>
                </Frame>

                <!-- Error Message -->
                <Label x:Name="ErrorLabel" 
                        TextColor="#FF6B6B" 
                        FontSize="14" 
                        IsVisible="False" 
                        HorizontalOptions="Center" />
            </VerticalStackLayout>
        </Grid>
    </ScrollView>
</ContentPage>
